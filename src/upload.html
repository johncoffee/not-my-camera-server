<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta charset="utf-8">
</head>
<body>
<form method="POST" action="/api/image" enctype="multipart/form-data">
    <h3 style="font-weight: bold">Take a photo!</h3>

    <p><input name=filefield type="file" accept="image/*" capture="camera"  onchange="changeEventHandler(event);">

    <p><input type="submit" style="font-size: 17px" value="Send!">

    <hr>
    <p><input type="hidden" name="alpha" placeholder="alpha">
    <p><input type="hidden" name="beta"  placeholder="beta">
    <p><input type="hidden" name="gamma" placeholder="gamma">
    <p><input type="hidden" name="userAgent" placeholder="gamma">
</form>

<script type="text/javascript">
  function changeEventHandler(event) {
    alert('You like ' + event.target.value + ' ice cream.');
  }

  if (window.DeviceOrientationEvent) {

    let fps = 10
    let refresh_freq = 1000 / fps
    let currentEvent = null
    window.addEventListener("deviceorientation", (event) => {
        currentEvent = event
    })

    document.querySelector(`[name="userAgent"]`).value = navigator.userAgent

    let p1 = document.querySelector(`[name="alpha"]`)
    let p2 = document.querySelector(`[name="beta"]`)
    let p3 = document.querySelector(`[name="gamma"]`)

    window.addEventListener("load", function () {
      window.setInterval(function () {
        if (currentEvent !== null) {
          p1.value = currentEvent.alpha
          p2.value = currentEvent.beta
          p3.value = currentEvent.gamma
        }
      }, refresh_freq)
    })
  } else {
    alert("Sorry, your browser doesn't support Device Orientation");
  }
</script>

</body>
</html>
