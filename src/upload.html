<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta charset="utf-8">
</head>
<body>
<form method="POST" action="/api/image" enctype="multipart/form-data" style="display: none">
    <h3 style="font-weight: bold">Take a photo!</h3>

    <p><input name=filefield type="file" accept="image/*" capture="camera"  onchange="changeEventHandler(event);">

    <p><input type="submit" style="font-size: 17px" value="Send!">

    <hr>
    <p><input type="hidden" name="alpha" placeholder="alpha">
    <p><input type="hidden" name="beta"  placeholder="beta">
    <p><input type="hidden" name="gamma" placeholder="gamma">
    <p><input type="hidden" name="userAgent" placeholder="gamma">
</form>

<script type="text/javascript">
  var currentEvent = null
  var debug = localStorage ? localStorage.debug == 1 : false
  if (debug) {
    document.querySelector("form").style.display = "block"
  }

  function changeEventHandler(event) {
    updateSensorFields()
  }

  if (window.DeviceOrientationEvent) {
    window.addEventListener("deviceorientation", (event) => {
        if (currentEvent === null) {
          document.querySelector("form").style.display = "block"
        }
        currentEvent = event
    })

    document.querySelector(`[name="userAgent"]`).value = navigator.userAgent

    function updateSensorFields () {
      if (currentEvent !== null) {
        let p1 = document.querySelector(`[name="alpha"]`)
        let p2 = document.querySelector(`[name="beta"]`)
        let p3 = document.querySelector(`[name="gamma"]`)

        p1.value = currentEvent.alpha
        p2.value = currentEvent.beta
        p3.value = currentEvent.gamma
      }
    }
  }
  else {
    document.querySelector("form").style.display = "none"
    alert("Sorry, your browser doesn't support Device Orientation");
  }
</script>

</body>
</html>
