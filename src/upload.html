<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta charset="utf-8">
</head>
<body>
<form method="POST" action="/api/image" enctype="multipart/form-data">
    <p><input type="text" name="alpha" placeholder="alpha">
    <p><input type="text" name="beta" placeholder="beta">
    <p><input type="text" name="gamma" placeholder="gamma">
    <p> Take a photo
        <input name=filefield type="file" accept="image/*" capture="camera">
    <p><input type="submit">
</form>

<script type="text/javascript">

  if (window.DeviceOrientationEvent) {

    let fps = 10
    let refresh_freq = 1000 / fps
    let currentEvent = null
    window.addEventListener("deviceorientation", (event) => {
        currentEvent = event
      deviceOrientationListener(event)
    })

    window.addEventListener("load", function () {
      window.setInterval(function () {
        if (currentEvent !== null) {
          document.querySelector(`[name="alpha"]`).value = currentEvent.alpha
          document.querySelector(`[name="beta"]`).value = currentEvent.beta
          document.querySelector(`[name="gamma"]`).value = currentEvent.gamma
        }
      }, refresh_freq)
    })
  } else {
    alert("Sorry, your browser doesn't support Device Orientation");
  }
</script>

<hr>
<p>Debug
<div>
    <canvas id="myCanvas" width="360" height="450" style="border:1px solid #d3d3d3;"></canvas>
</div>
<script>
  function deviceOrientationListener(event) {
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");

    ctx.clearRect(0, 0, c.width, c.height);
    ctx.fillStyle = "#FF7777";
    ctx.font = "14px Verdana";
    ctx.fillText("Alpha: " + Math.Round(event.alpha), 10, 20);
    ctx.beginPath();
    ctx.moveTo(180, 75);
    ctx.lineTo(210, 75);
    ctx.arc(180, 75, 60, 0, event.alpha * Math.PI / 180);
    ctx.fill();

    ctx.fillStyle = "#FF6600";
    ctx.fillText("Beta: " + Math.round(event.beta), 10, 140);
    ctx.beginPath();
    ctx.fillRect(180, 150, event.beta, 90);

    ctx.fillStyle = "#FF0000";
    ctx.fillText("Gamma: " + Math.round(event.gamma), 10, 270);
    ctx.beginPath();
    ctx.fillRect(90, 340, 180, event.gamma);
  }
</script>

</body>
</html>
